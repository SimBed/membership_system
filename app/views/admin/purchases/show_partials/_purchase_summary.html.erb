<table class="table table-secondary table-striped caption-top">
  <caption>
    <%= link_to @purchase.formal_name, admin_purchase_path(@purchase), class: "like_button" if setting == 'admin_client_show' %>
    <%= 'Summary' if setting == 'admin_purchase_show' %>
  </caption>
  <tbody>
    <tr>
      <th scope="row">Payment</th>
      <td><%= rupees(@purchase.payment) %></td>
    </tr>
    <tr>
      <th scope="row">Base Price</th>
      <td><%= rupees(@purchase.price.price) %></td>
    </tr>
    <tr>
    <% unless @purchase.discounts.empty? %>
      <% discount = @purchase.discounts.first %>
      <tr>
        <th scope="row">Discount Name</th>
        <td><%= discount.name %></td>
      </tr>
      <tr>
      <% if discount.percent.zero? %>
        <th scope="row">Fixed Discount</th>
        <td><%= rupees(discount.fixed) %></td>
      <% else %>
        <th scope="row">Discount Percent</th>
        <td><%= "#{number_with_precision(discount.percent, strip_insignificant_zeros: true)}%" %></td>    
      <% end %>
      </tr>
      <tr>
        <th scope="row">Discount Amount</th>
        <td><%= rupees(@purchase.price.price - @purchase.payment) %></td>
      </tr>      
    <% end %>
    <tr>
      <th scope="row">Paid on</th>
      <td><%= @purchase.dop.strftime('%d %b %y') %></td>
    </tr>
    <tr>
      <th scope="row">Status</th>
      <td><%= @purchase.status %></td>
    </tr>
    <% unless @purchase.not_started? %>
      <tr>
        <th scope="row">Expiry date</th>
        <td><%= @purchase.expiry_date&.strftime('%d %b %y') %></td>
      </tr>
    <% end %>
    <% unless @purchase.expired? %>    
      <tr>
        <th scope="row">Sunset date</th>
        <td><%= @purchase.sunset_date.strftime('%d %b %y') %></td>
      </tr>  
    <% end %>     
    <% unless @sunset_hash[:action].nil? %>
      <tr>
        <th scope="row">Sunset action</th>
        <td><%= link_to (tag.i class: ["bi", @sunset_hash[:image], ("" if  @purchase.expired?)]), expire_purchase_path(@purchase), data: { turbo_method: :patch , turbo_confirm: @sunset_hash[:confirm] } %></td>
      </tr>
    <% end %>   
    <% unless @purchase.not_started? || @purchase.expired? %>
      <tr>
        <th scope="row">Bookings left</th>
        <td><%= @purchase.attendances_remain(provisional: true) %></td>
      </tr>
      <tr>
        <th scope="row">Attendances left</th>
        <td><%= @purchase.attendances_remain(provisional: false) %></td>
      </tr>
    <% end %>
    <% if @purchase.expired? %>
      <tr>
        <th scope="row">Expiry cause</th>
        <td><%= @purchase.expiry_cause %></td>
      </tr>
      <tr>
        <th scope="row">Expired on</th>
        <td><%= @purchase.expired_on&.strftime('%d %b %y') %></td>
      </tr>
    <% end %>
    <% if @purchase.provisionally_expired? %>
      <tr>
        <th scope="row">Will expire on</th>
        <td><%= @purchase.will_expire_on&.strftime('%d %b %y') %></td>
      </tr>
    <% end %>
    <tr>
      <th scope="row">Payment mode</th>
      <td><%= @purchase.payment_mode%></td>
    </tr>
    <tr>
      <th scope="row">Invoice</th>
      <td><%= @purchase.invoice %></td>
    </tr>
    <tr>
      <th scope="row">Note</th>
      <td><%= @purchase.note %></td>
    </tr>
    <% if @purchase.adjust_restart %>
      <tr>
        <th scope="row">A&R paid</th>
        <td><%= rupees(@purchase.ar_payment) %></td>
      </tr>
      <tr>
        <th scope="row">A&R paid on</th>
        <td><%= @purchase.ar_date.strftime('%d %b %y') %></td>
      </tr>
    <% end %>

  </tbody>
</table>
